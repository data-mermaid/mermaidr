<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WCS Vibrant Oceans Baseline Coral Reef Monitoring • mermaidr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="WCS Vibrant Oceans Baseline Coral Reef Monitoring">
<meta property="og:description" content="mermaidr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mermaidr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Case Studies</li>
    <li>
      <a href="../articles/vo_baseline_monitoring.html">WCS Vibrant Oceans Baseline Coral Reef Monitoring</a>
    </li>
    <li>
      <a href="../articles/importing_fishbelt.html">Ingesting legacy data into MERMAID</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Getting Started</li>
    <li>
      <a href="../articles/new_to_r.html">Getting started with R</a>
    </li>
    <li>
      <a href="../articles/getting_help.html">Getting help with mermaidr</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Detailed Usage</li>
    <li>
      <a href="../articles/accessing_project_data.html">Accessing Project Data</a>
    </li>
    <li>
      <a href="../articles/accessing_dev_collect_data.html">Accessing data from the development version of MERMAID</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/data-mermaid/mermaidr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>WCS Vibrant Oceans Baseline Coral Reef
Monitoring</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/data-mermaid/mermaidr/blob/HEAD/vignettes/articles/vo_baseline_monitoring.Rmd" class="external-link"><code>vignettes/articles/vo_baseline_monitoring.Rmd</code></a></small>
      <div class="hidden name"><code>vo_baseline_monitoring.Rmd</code></div>

    </div>

    
    
<p>This case study follows an analysis of baseline coral reef studies
for Vibrant Oceans, completed by the Wildlife Conservation Society
(WCS). The original survey and analysis covered 168 sites across
Tanzania, Fiji, and Indonesia, surveying underwater information across a
diversity of management, habitat types, and other environmental
characteristics. This analysis is a small subset, only using publicly
available data, and intended to illustrate the usage of
<code>mermaidr</code> for such a project.</p>
<p>First, we load <code>mermaidr</code> and search for projects tagged
with “Vibrant Oceans”:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://data-mermaid.github.io/mermaidr" class="external-link">mermaidr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">vo_projects</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mermaid_search_projects.html">mermaid_search_projects</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"Vibrant Oceans"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vo_projects</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 15</span></span>
<span><span class="co">#&gt;   id                  name  countries num_sites tags  notes status data_policy_beltfish</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt; &lt;chr&gt;         &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 3a9ecb7c-f908-4262… Aceh… Indonesia        18 WCS … ""    Open   Private             </span></span>
<span><span class="co">#&gt; 2 507d1af9-edbd-417e… Kari… Indonesia        43 WCS … ""    Open   Private             </span></span>
<span><span class="co">#&gt; 3 5f13e6dc-40cc-4ef9… Copy… Indonesia        43 WCS … ""    Open   Public Summary      </span></span>
<span><span class="co">#&gt; 4 95e0ffc7-3a7d-4538… 2019… Fiji             44 WCS … ""    Open   Private             </span></span>
<span><span class="co">#&gt; 5 bcb1f115-804d-4b23… Taka… Indonesia        39 WCS … ""    Open   Public Summary      </span></span>
<span><span class="co">#&gt; # ℹ 7 more variables: data_policy_benthiclit &lt;chr&gt;, data_policy_benthicpit &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   data_policy_benthicpqt &lt;chr&gt;, data_policy_habitatcomplexity &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   data_policy_bleachingqc &lt;chr&gt;, created_on &lt;chr&gt;, updated_on &lt;chr&gt;</span></span></code></pre></div>
<p>For this analysis, WCS field teams accessed ecological condition
using underwater surveys to assess two key indicators of coral reef
health: live hard coral cover and reef fish biomass. This data is
available from <code>mermaidr</code> via the benthic PIT and fishbelt
methods, respectively. We’ll focus on projects that have summary data
publicly available for these methods.</p>
<p>We are able to see the data policy of projects and methods by looking
at the <code>data_policy_*</code> columns of <code>vo_projects</code>.
For example, focusing on benthic PIT and fishbelt, we can see that the
Taka Bonerate NP-2019 project has summary data publicly available for
fishbelt and benthic PIT, while the 2019 Dama Bureta Waibula and
Dawasamu-WISH ecological survey has public data available for only
benthic PIT.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">vo_projects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">data_policy_beltfish</span>, <span class="va">data_policy_benthicpit</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span><span class="co">#&gt;   name                                      data_policy_beltfish data_policy_benthicpit</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                     &lt;chr&gt;                &lt;chr&gt;                 </span></span>
<span><span class="co">#&gt; 1 Aceh Jaya Coastal Park                    Private              Private               </span></span>
<span><span class="co">#&gt; 2 Karimunjawa National Park                 Private              Private               </span></span>
<span><span class="co">#&gt; 3 Copy of Karimunjawa National Park_2022    Public Summary       Public Summary        </span></span>
<span><span class="co">#&gt; 4 2019_Dama Bureta Waibula and Dawasamu-WI… Private              Public Summary        </span></span>
<span><span class="co">#&gt; 5 Taka Bonerate NP-2019                     Public Summary       Public Summary</span></span></code></pre></div>
<div class="section level2">
<h2 id="live-hard-coral-cover">Live hard coral cover<a class="anchor" aria-label="anchor" href="#live-hard-coral-cover"></a>
</h2>
<p>We’ll focus on hard coral (benthic PIT) data first. We can get this
data by filtering for projects that have publicly available summary data
for it (returning both the Taka Bonerate and Dama Bureta Waibula and
Dawasamu projects):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projects_public_benthic</span> <span class="op">&lt;-</span> <span class="va">vo_projects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data_policy_benthicpit</span> <span class="op">==</span> <span class="st">"Public Summary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">projects_public_benthic</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 1</span></span>
<span><span class="co">#&gt;   name                                                        </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                                       </span></span>
<span><span class="co">#&gt; 1 Copy of Karimunjawa National Park_2022                      </span></span>
<span><span class="co">#&gt; 2 2019_Dama Bureta Waibula and Dawasamu-WISH ecological survey</span></span>
<span><span class="co">#&gt; 3 Taka Bonerate NP-2019</span></span></code></pre></div>
<p>And then by querying for public summary data, using
<code><a href="../reference/mermaid_get_project_data.html">mermaid_get_project_data()</a></code>, specifying the “benthicpit”
method with “sampleevents” data. The key to accessing public summary
data is to set our token to <code>NULL</code> - this makes it so that
<code>mermaidr</code> won’t try to authenticate us, and instead just
returns the data <em>if</em> the data policy allows it.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benthic_data</span> <span class="op">&lt;-</span> <span class="va">projects_public_benthic</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mermaid_get_project_data.html">mermaid_get_project_data</a></span><span class="op">(</span><span class="st">"benthicpit"</span>, <span class="st">"sampleevents"</span>, token <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">benthic_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 40</span></span>
<span><span class="co">#&gt;   project      tags  country site  latitude longitude reef_type reef_zone reef_exposure</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;        </span></span>
<span><span class="co">#&gt; 1 2019_Dama B… Vibr… Fiji    BuC1     -17.6      179. fringing  fore reef sheltered    </span></span>
<span><span class="co">#&gt; 2 2019_Dama B… Vibr… Fiji    BuC2     -17.7      179. fringing  fore reef sheltered    </span></span>
<span><span class="co">#&gt; 3 2019_Dama B… Vibr… Fiji    BuC3     -17.6      179. fringing  fore reef sheltered    </span></span>
<span><span class="co">#&gt; 4 2019_Dama B… Vibr… Fiji    BuC4     -17.7      179. fringing  fore reef sheltered    </span></span>
<span><span class="co">#&gt; 5 2019_Dama B… Vibr… Fiji    BuC5     -17.6      179. fringing  fore reef sheltered    </span></span>
<span><span class="co">#&gt; 6 2019_Dama B… Vibr… Fiji    BuC6     -17.7      179. fringing  fore reef sheltered    </span></span>
<span><span class="co">#&gt; # ℹ 31 more variables: tide &lt;chr&gt;, current &lt;chr&gt;, visibility &lt;chr&gt;, management &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   management_secondary &lt;chr&gt;, management_est_year &lt;int&gt;, management_size &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   management_parties &lt;chr&gt;, management_compliance &lt;chr&gt;, management_rules &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   sample_date &lt;date&gt;, depth_avg &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   percent_cover_benthic_category_avg_sand &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   percent_cover_benthic_category_avg_trash &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   percent_cover_benthic_category_avg_rubble &lt;dbl&gt;, …</span></span></code></pre></div>
<p>At a high level, this returns the aggregations for a survey at the
<em>sample event</em> level; roughly, it provides a summary of all
observations for all transects at a given site and date, giving us
information like the average percent cover for each benthic category.
Let’s focus in on the <code>country</code>, <code>site</code>, and
<code>percent_cover_benthic_category_avg_hard_coral</code> columns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benthic_data</span> <span class="op">&lt;-</span> <span class="va">benthic_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">site</span>, hard_coral <span class="op">=</span> <span class="va">percent_cover_benthic_category_avg_hard_coral</span><span class="op">)</span></span></code></pre></div>
<p>We’d like to summarise hard coral coverage across these sites. WCS
considers a 10% cover as a minimum threshold of carbonate production and
reef growth, while 30% cover may be more related to a threshold for
biodiversity and fisheries production, so we will aggregate and
visualize the coverage.</p>
<p>First, let’s categorize each value of <code>hard_coral</code>
according to whether it’s below 10%, between 10% and 30%, or above
30%:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benthic_data</span> <span class="op">&lt;-</span> <span class="va">benthic_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">hard_coral</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"Below 10% cover"</span>,</span>
<span>    <span class="va">hard_coral</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">hard_coral</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"Midrange 10-30% cover"</span>,</span>
<span>    <span class="va">hard_coral</span> <span class="op">&gt;=</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"Above 30% hard coral cover"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can count how many fall into each category - it looks like the
bulk of sites (57%) fall into the midrange 10 - 30% cover category, a
small number (8.9%) are below 10%, and about a third (34.2%) of surveyed
sites have above 30% hard coral cover.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benthic_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   threshold                      n   prop</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Above 30% hard coral cover    27 0.342 </span></span>
<span><span class="co">#&gt; 2 Below 10% cover                7 0.0886</span></span>
<span><span class="co">#&gt; 3 Midrange 10-30% cover         45 0.570</span></span></code></pre></div>
<p>We’d also like to see the distribution of these values - for example,
what do those 10 - 30% coverages actually look like?</p>
<p>Let’s visualize the data, using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">benthic_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hard_coral</span>, y <span class="op">=</span> <span class="va">site</span>, fill <span class="op">=</span> <span class="va">threshold</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="vo-unnamed-chunk-9-1.png" title="A bar chart with hard coral cover on the x axis (titled hard_coral) and sites on the y axis (titled site). The bars are colored in pink, green, and blue, according to whether they have above 30% hard coral cover, below 10% cover, or 10-30% cover, respectively. The sites are ordered alphabeticaly." alt="A bar chart with hard coral cover on the x axis (titled hard_coral) and sites on the y axis (titled site). The bars are colored in pink, green, and blue, according to whether they have above 30% hard coral cover, below 10% cover, or 10-30% cover, respectively. The sites are ordered alphabeticaly."></p>
<p>This is a good start, but it would probably be much more useful with
a few changes. We can recorder the sites so that they go in descending
order, from highest to lowest hard coral coverage. We can also rearrange
the threshold legend, so that it follows a logical order, from highest
to lowest coverage (instead of alphabetical). It would also be helpful
to add a line at the 10% and 30% points, to visualize those thresholds
more explicitly.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benthic_data</span> <span class="op">&lt;-</span> <span class="va">benthic_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    threshold <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="va">hard_coral</span>, .desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    site <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">hard_coral</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">hard_coral_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">benthic_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hard_coral</span>, y <span class="op">=</span> <span class="va">site</span>, fill <span class="op">=</span> <span class="va">threshold</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">10</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">30</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hard_coral_plot</span></span></code></pre></div>
<p><img src="vo-unnamed-chunk-10-1.png" title="A bar chart with hard coral cover on the x axis (titled hard_coral) and sites on the y axis (titled site). The bars are colored in pink, green, and blue, according to whether they have above 30% hard coral cover, 10-30% cover, or below 10% cover. The sites are ordered by their hard coral coverage, from highest to lowest. There is a dashed vertical line at 10% and 30% hard coral." alt="A bar chart with hard coral cover on the x axis (titled hard_coral) and sites on the y axis (titled site). The bars are colored in pink, green, and blue, according to whether they have above 30% hard coral cover, 10-30% cover, or below 10% cover. The sites are ordered by their hard coral coverage, from highest to lowest. There is a dashed vertical line at 10% and 30% hard coral."></p>
<p>Finally, we can make some visual changes, like updating the theme,
removing the site names (we care more about the distribution than which
site they correspond to for this plot), adding axis labels for every
10%, cleaning up labels, and some other fiddly bits to create a
beautiful plot!</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hard_coral_plot</span> <span class="op">&lt;-</span> <span class="va">hard_coral_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Hard coral cover, %"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">70</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Threshold"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#7F7F7F"</span>, <span class="st">"#F1A83B"</span>, <span class="st">"#E73F25"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A sample of WCS Vibrant Oceans survey sites, ordered by hard coral cover"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">hard_coral_plot</span></span></code></pre></div>
<p><img src="vo-unnamed-chunk-11-1.png" title="A bar chart with hard coral cover on the x axis and sites on the y axis. The bars are colored in grey, yellow, and red, according to whether they have above 30% hard coral cover, 10-30% cover, or below 10% cover. The sites are ordered by their hard coral coverage, from highest to lowest. There is a vertical line at 10% and 30% hard coral cover. The site names have been removed and the plot now has a title: A sample of WCS Vibrant Ocean survey sites, ordered by hard coral cover. The x axis is titled: Hard coral cover, %." alt="A bar chart with hard coral cover on the x axis and sites on the y axis. The bars are colored in grey, yellow, and red, according to whether they have above 30% hard coral cover, 10-30% cover, or below 10% cover. The sites are ordered by their hard coral coverage, from highest to lowest. There is a vertical line at 10% and 30% hard coral cover. The site names have been removed and the plot now has a title: A sample of WCS Vibrant Ocean survey sites, ordered by hard coral cover. The x axis is titled: Hard coral cover, %."></p>
<p>That looks much better!</p>
</div>
<div class="section level2">
<h2 id="reef-fish-biomass">Reef fish biomass<a class="anchor" aria-label="anchor" href="#reef-fish-biomass"></a>
</h2>
<p>Next, let’s turn to reef fish biomass. Similarly to the step above,
we can get this data by filtering for projects that have publicly
available summary data for it, returning only the Taka Bonerate
project.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projects_public_fishbelt</span> <span class="op">&lt;-</span> <span class="va">vo_projects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data_policy_beltfish</span> <span class="op">==</span> <span class="st">"Public Summary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">projects_public_fishbelt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 1</span></span>
<span><span class="co">#&gt;   name                                  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                 </span></span>
<span><span class="co">#&gt; 1 Copy of Karimunjawa National Park_2022</span></span>
<span><span class="co">#&gt; 2 Taka Bonerate NP-2019</span></span></code></pre></div>
<p>Next, we query for public summary data, again using
<code>mermaid_get_project_data</code> to get “sampleevents” data, this
time specifying the “fishbelt” method:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishbelt_data</span> <span class="op">&lt;-</span> <span class="va">projects_public_fishbelt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mermaid_get_project_data.html">mermaid_get_project_data</a></span><span class="op">(</span><span class="st">"fishbelt"</span>, <span class="st">"sampleevents"</span>, token <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fishbelt_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 87</span></span>
<span><span class="co">#&gt;   project      tags  country site  latitude longitude reef_type reef_zone reef_exposure</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;        </span></span>
<span><span class="co">#&gt; 1 Taka Bonera… Vibr… Indone… Ampa…    -6.92      121. atoll     back reef sheltered    </span></span>
<span><span class="co">#&gt; 2 Taka Bonera… Vibr… Indone… Bela…    -6.40      121. atoll     fore reef exposed      </span></span>
<span><span class="co">#&gt; 3 Taka Bonera… Vibr… Indone… Bung…    -6.82      121. atoll     fore reef exposed      </span></span>
<span><span class="co">#&gt; 4 Taka Bonera… Vibr… Indone… Jina…    -6.77      121. atoll     fore reef exposed      </span></span>
<span><span class="co">#&gt; 5 Taka Bonera… Vibr… Indone… Jina…    -6.76      121. atoll     back reef semi-exposed </span></span>
<span><span class="co">#&gt; 6 Taka Bonera… Vibr… Indone… Kayu…    -6.81      121. fringing  fore reef exposed      </span></span>
<span><span class="co">#&gt; # ℹ 78 more variables: tide &lt;chr&gt;, current &lt;chr&gt;, visibility &lt;chr&gt;, management &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   management_secondary &lt;chr&gt;, management_est_year &lt;int&gt;, management_size &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   management_parties &lt;chr&gt;, management_compliance &lt;chr&gt;, management_rules &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   sample_date &lt;date&gt;, depth_avg &lt;dbl&gt;, biomass_kgha_avg &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   biomass_kgha_trophic_group_avg_omnivore &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   biomass_kgha_trophic_group_avg_piscivore &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   biomass_kgha_trophic_group_avg_planktivore &lt;dbl&gt;, …</span></span></code></pre></div>
<p>Again, this summarises all observations for all transects at a given
site and date, and gives us information like the average biomass at that
site, and average biomass across groupings like trophic group or fish
family.</p>
<p>We’ll just focus on the average biomass:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishbelt_data</span> <span class="op">&lt;-</span> <span class="va">fishbelt_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">site</span>, biomass <span class="op">=</span> <span class="va">biomass_kgha_avg</span><span class="op">)</span></span></code></pre></div>
<p>WCS considers 500 kg/ha as a threshold where below this biomass,
ecosystems may pass critical thresholds of ecosystem decline, and often
seek to maintain reef fish biomass above 500 kg/ha as a management
target. Let’s categorize each value of <code>biomass</code> according to
whether it’s above or below 500 kg/ha, and reorder both the sites and
the threshold factor from highest to lowest biomass:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishbelt_data</span> <span class="op">&lt;-</span> <span class="va">fishbelt_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    threshold <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">biomass</span> <span class="op">&gt;=</span> <span class="fl">500</span> <span class="op">~</span> <span class="st">"Above 500 kg/ha"</span>,</span>
<span>      <span class="va">biomass</span> <span class="op">&lt;</span> <span class="fl">500</span> <span class="op">~</span> <span class="st">"Below 500 kg/ha"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="va">biomass</span>, .desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    site <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">biomass</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Then, we can visualize the distribution of average biomass in sites,
similar to our visualization before:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fishbelt_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">biomass</span>, y <span class="op">=</span> <span class="va">site</span>, fill <span class="op">=</span> <span class="va">threshold</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">500</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Total reef fish biomass, kg/ha"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Threshold"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#7F7F7F"</span>, <span class="st">"#E73F25"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A sample of WCS Vibrant Oceans survey sites, ordered by reef fish biomass"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="vo-unnamed-chunk-16-1.png" title="A bar chart showing total reef fish biomass in kilograms per hectare (on the axis) by site (on the y axis). The sites are shown in order of their biomass, from highest to lowest. The bars are grey if the biomass is above 500 kg and red if it is below 500kg. There is a vertical dashed line at the 500kg mark. The plot is titled 'A sample of WCS Vibrant Oceans survey sites, ordered by reef fish biomass.'" alt="A bar chart showing total reef fish biomass in kilograms per hectare (on the axis) by site (on the y axis). The sites are shown in order of their biomass, from highest to lowest. The bars are grey if the biomass is above 500 kg and red if it is below 500kg. There is a vertical dashed line at the 500kg mark. The plot is titled 'A sample of WCS Vibrant Oceans survey sites, ordered by reef fish biomass.'"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sharla Gelfand, Wildlife Conservation Society.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
